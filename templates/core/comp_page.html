{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upcoming Competitions</title>
  <link rel="stylesheet" href="{% static 'core/landing/comp.css' %}" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    @font-face {
      font-family: 'Saotorpes';
      src: url("{% static 'core/fonts/SaoTorpes.otf' %}") format('opentype');
    }
  </style>
</head>
<body>
<section class="competitions-section">
  <h2 class="section-title">Upcoming Competitions</h2>

  <div class="carousel">
    {% for city in cities %}
      {% for event in city.events.all %}
        <div class="competition-card">
          <div class="image-container">
            <img src="{{ city.image.url }}" alt="{{ event.name }}">
            <span class="badge">{{ event.event_type|upper }}</span>
          </div>
          <div class="card-content">
            <h3 class="event-title">{{ event.name }}</h3>
            <p class="event-subtitle">{{ event.description }}</p>
            <div class="event-info">
              <p>üìÖ {{ city.time|date:"D, d.m" }}</p>
              <p>üìç {{ city.venue }}</p>
            </div>
            <div class="card-footer">
              <div class="shapes">
                <img src="{% static 'core/landing/small2.svg' %}" alt="">
                <img src="{% static 'core/landing/small.svg' %}" alt="">
              </div>
              <button class="register-button">Register</button>
            </div>
          </div>
        </div>
      {% endfor %}
    {% endfor %}
  </div>
  

  <div class="pagination-arrows">
    <div class="pagination"></div>
    <div class="nav-arrows">
      <button class="nav-btn left">‚Üê</button>
      <button class="nav-btn right">‚Üí</button>
    </div>
  </div>
  
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const carousel = document.querySelector('.carousel');
    const leftArrow = document.querySelector('.nav-btn.left');
    const rightArrow = document.querySelector('.nav-btn.right');
    const pagination = document.querySelector('.pagination');
    const cards = document.querySelectorAll('.competition-card');

    if (!carousel || cards.length === 0) return;

    const cardStyle = window.getComputedStyle(cards[0]);
    const gap = parseInt(cardStyle.marginRight || 20);
    const cardWidth = cards[0].offsetWidth + gap;
    const carouselWidth = carousel.clientWidth;

    const visibleCards = Math.floor(carouselWidth / cardWidth);
    const totalPages = Math.ceil(cards.length / visibleCards);
    let currentPage = 0;

    // Clear any previous dots (important if this re-runs)
    pagination.innerHTML = '';

    // Generate pagination dots
    for (let i = 0; i < totalPages; i++) {
      const dot = document.createElement('span');
      dot.classList.add('dot');
      if (i === 0) dot.classList.add('active');
      dot.addEventListener('click', () => {
        currentPage = i;
        scrollToPage();
      });
      pagination.appendChild(dot);
    }

    const updateDots = () => {
      document.querySelectorAll('.dot').forEach((dot, index) => {
        dot.classList.toggle('active', index === currentPage);
      });
    };

    function scrollToPage() {
      carousel.scrollTo({
        left: currentPage * cardWidth * visibleCards,
        behavior: 'smooth'
      });
      updateDots();
    }

    leftArrow.addEventListener('click', () => {
      if (currentPage > 0) {
        currentPage--;
        scrollToPage();
      }
    });

    rightArrow.addEventListener('click', () => {
      if (currentPage < totalPages - 1) {
        currentPage++;
        scrollToPage();
      }
    });
  });
</script>

</body>
</html>
